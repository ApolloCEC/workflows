---
name: "BWA"
dataIns:
- name: "s3bucket"
  type: "string"
  source: "s3bucket"
- name: "files"
  type: "collection"
  source: "files"
- name: "numSplits"
  type: "number"
  source: "numSplits"
workflowBody:
- function:
    name: "bwa-split"
    type: "Collection"
    dataIns:
    - name: "s3bucket"
      type: "string"
      source: "BWA/s3bucket"
    - name: "files"
      type: "string"
      source: "BWA/files"
    - name: "numSplits"
      type: "number"
      source: "BWA/numSplits"
    dataOuts:
    - name: "s3bucket"
      type: "string"
    - name: "files"
      type: "string"
    - name: "s3prefixes"
      type: "collection"
    - name: "r1s3keys"
      type: "collection"
    - name: "r2s3keys"
      type: "collection"
    - name: "s3mainprefix"
      type: "string"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-central-1:735406098573:function:bwa-split"
- function:
    name: "bwa-index"
    type: "collection"
    dataIns:
    - name: "s3bucket"
      type: "string"
      source: "bwa-split/s3bucket"
    - name: "files"
      type: "string"
      source: "bwa-split/files"
    - name: "s3mainprefix"
      type: "string"
      source: "bwa-split/s3mainprefix"
    dataOuts:
    - name: "s3bucket"
      type: "string"
    - name: "files"
      type: "string"
    - name: "s3mainprefix"
      type: "string"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-central-1:735406098573:function:bwa-index"
- parallelFor:
    name: "ParallelFor"
    dataIns:
    - name: "s3bucket"
      type: "string"
      source: "bwa-index/s3bucket"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "files"
      type: "string"
      source: "bwa-index/files"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    - name: "s3prefix"
      type: "string"
      source: "bwa-split/s3prefixes"
      constraints:
      - name: "distribution"
        value: "BLOCK(1)"
    - name: "r1s3key"
      type: "collection"
      source: "bwa-split/r1s3keys"
      constraints:
      - name: "distribution"
        value: "BLOCK(1)"
    - name: "r2s3key"
      type: "collection"
      source: "bwa-split/r2s3keys"
      constraints:
      - name: "distribution"
        value: "BLOCK(1)"
    - name: "s3mainprefix"
      type: "string"
      source: "bwa-index/s3mainprefix"
      constraints:
      - name: "distribution"
        value: "REPLICATE(*)"
    loopCounter:
      type: "number"
      to: "BWA/numSplits"
      step: "1"
    loopBody:
    - function:
        name: "bwa-aln"
        type: "Collection"
        dataIns:
        - name: "s3bucket"
          type: "string"
          source: "ParallelFor/s3bucket"
        - name: "files"
          type: "string"
          source: "ParallelFor/files"
        - name: "s3prefix"
          type: "string"
          source: "ParallelFor/s3prefix"
        - name: "r1s3key"
          type: "string"
          source: "ParallelFor/r1s3key"
        - name: "r2s3key"
          type: "string"
          source: "ParallelFor/r2s3key"
        - name: "s3mainprefix"
          type: "string"
          source: "ParallelFor/s3mainprefix"
        dataOuts:
        - name: "s3bucket"
          type: "string"
        - name: "files"
          type: "string"
        - name: "s3prefix"
          type: "string"
        - name: "sai1s3key"
          type: "string"
        - name: "sai2s3key"
          type: "string"
        - name: "r1s3key"
          type: "string"
        - name: "r2s3key"
          type: "string"
        properties:
        - name: "resource"
          value: "arn:aws:lambda:eu-central-1:735406098573:function:bwa-aln"
    - function:
        name: "bwa-sampe"
        type: "Collection"
        dataIns:
        - name: "s3bucket"
          type: "string"
          source: "bwa-aln/s3bucket"
        - name: "files"
          type: "string"
          source: "bwa-aln/files"
        - name: "s3prefix"
          type: "string"
          source: "bwa-aln/s3prefix"
        - name: "r1s3key"
          type: "string"
          source: "bwa-aln/r1s3key"
        - name: "r2s3key"
          type: "string"
          source: "bwa-aln/r2s3key"
        - name: "sai1s3key"
          type: "string"
          source: "bwa-aln/sai1s3key"
        - name: "sai2s3key"
          type: "string"
          source: "bwa-aln/sai2s3key"
        dataOuts:
        - name: "s3bucket"
          type: "string"
        - name: "files"
          type: "string"
        - name: "s3prefix"
          type: "string"
        - name: "s3samkey"
          type: "string"
        properties:
        - name: "resource"
          value: "arn:aws:lambda:eu-central-1:735406098573:function:bwa-sampe"
    dataOuts:
    - name: "s3bucket"
      type: "string"
      source: "bwa-sampe/s3bucket"
    - name: "s3prefix"
      type: "string"
      source: "bwa-sampe/s3prefix"
    - name: "s3samkeys"
      type: "collection"
      source: "bwa-sampe/s3samkey"
- function:
    name: "bwa-merge"
    type: "Collection"
    dataIns:
    - name: "s3bucket"
      type: "string"
      source: "ParallelFor/s3bucket"
    - name: "s3prefix"
      type: "string"
      source: "ParallelFor/s3prefix"
    - name: "s3samkeys"
      type: "collection"
      source: "ParallelFor/s3samkeys"
    dataOuts:
    - name: "s3bucket"
      type: "string"
    - name: "s3prefix"
      type: "string"
    - name: "mergedsamkey"
      type: "string"
    properties:
    - name: "resource"
      value: "arn:aws:lambda:eu-central-1:735406098573:function:bwa-merge"
dataOuts:
- name: "s3bucket"
  type: "string"
  source: "bwa-merge/s3bucket"
- name: "mergedsamkey"
  type: "string"
  source: "bwa-merge/mergedsamkey"
- name: "s3prefix"
  type: "string"
  source: "bwa-merge/s3prefix"
